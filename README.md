# AI Ethics Dilemma Game - Frontend System

> ì‹¤ì‹œê°„ ë‹¤ìê°„ ìŒì„± í† ë¡  ë° AI ìœ¤ë¦¬ ë”œë ˆë§ˆ í˜‘ì—… í•™ìŠµ í”Œë«í¼ í”„ë¡ íŠ¸ì—”ë“œ

[![React](https://img.shields.io/badge/React-19.1.0-61DAFB?style=flat-square&logo=react)](https://reactjs.org/)
[![Vite](https://img.shields.io/badge/Vite-6.3.5-646CFF?style=flat-square&logo=vite)](https://vitejs.dev/)
[![WebRTC](https://img.shields.io/badge/WebRTC-P2P-333333?style=flat-square&logo=webrtc)](https://webrtc.org/)
[![Axios](https://img.shields.io/badge/Axios-1.9.0-5A29E4?style=flat-square)](https://axios-http.com/)

**í”„ë¡œë•ì…˜ URL**: https://dilemmai-idl.com/  
**í”„ë¡œì íŠ¸ ê¸°ê°„**: 2024.09 - 2025.02 (6ê°œì›”)

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
2. [í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ](#-í•µì‹¬-ê¸°ìˆ -ìŠ¤íƒ)
3. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
4. [ì£¼ìš” ê¸°ëŠ¥ ë° ê¸°ìˆ ì  ë„ì „](#-ì£¼ìš”-ê¸°ëŠ¥-ë°-ê¸°ìˆ ì -ë„ì „)
5. [ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„](#-ì‹¤ì‹œê°„-í†µì‹ -êµ¬í˜„)
6. [WebRTC ìŒì„± í†µì‹ ](#-webrtc-ìŒì„±-í†µì‹ )
7. [ìƒíƒœ ê´€ë¦¬ ë° ë™ê¸°í™”](#-ìƒíƒœ-ê´€ë¦¬-ë°-ë™ê¸°í™”)
8. [ì„±ëŠ¥ ìµœì í™”](#-ì„±ëŠ¥-ìµœì í™”)
9. [ë¸Œë¼ìš°ì € í˜¸í™˜ì„±](#-ë¸Œë¼ìš°ì €-í˜¸í™˜ì„±)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
11. [í–¥í›„ ê°œì„ ì‚¬í•­](#-í–¥í›„-ê°œì„ ì‚¬í•­)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

### ë°°ê²½ ë° ëª©ì 
AI ìœ¤ë¦¬ êµìœ¡ì„ ìœ„í•œ **ì‹¤ì‹œê°„ í˜‘ì—… í•™ìŠµ í”Œë«í¼**ìœ¼ë¡œ, 3ëª…ì˜ ì°¸ê°€ìê°€ ê°ê¸° ë‹¤ë¥¸ ì´í•´ê´€ê³„ì ì—­í• ì„ ë§¡ì•„ AI ìœ¤ë¦¬ ë”œë ˆë§ˆ ìƒí™©ì—ì„œ **ì‹¤ì‹œê°„ ìŒì„± í† ë¡ **ì„ í†µí•´ í•©ì˜ì ì„ ë„ì¶œí•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### í•µì‹¬ ê°€ì¹˜
- âœ… **ì‹¤ì‹œê°„ ìŒì„± í†µì‹ **: WebRTC P2P ê¸°ë°˜ ëŠê¹€ ì—†ëŠ” 3ì ìŒì„± ì—°ê²°
- âœ… **ì•ˆì •ì ì¸ ì—°ê²° ê´€ë¦¬**: WebSocket ì¬ì—°ê²°, ìƒˆë¡œê³ ì¹¨ ë³µêµ¬, ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ì‘
- âœ… **ì§ê´€ì ì¸ UX**: ë³µì¡í•œ ê¸°ìˆ ì„ ì‚¬ìš©ìê°€ ì¸ì§€í•˜ì§€ ëª»í•˜ë„ë¡ ì‹¬í”Œí•œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- âœ… **í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì €**: Chrome, Safari, Firefox ë“± ì£¼ìš” ë¸Œë¼ìš°ì € ì§€ì›

### í”„ë¡œì íŠ¸ ê·œëª¨
- **ì´ í˜ì´ì§€**: 40+ í˜ì´ì§€ (ê²Œì„ í”Œë¡œìš°, ë°© ìƒì„±/ì…ì¥, ë§ˆì´í¬ í…ŒìŠ¤íŠ¸ ë“±)
- **ì»´í¬ë„ŒíŠ¸**: 60+ ê°œì˜ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
- **ì‹¤ì‹œê°„ ì‚¬ìš©ì**: ë™ì‹œ ì ‘ì† 50+ ì„¸ì…˜ ì§€ì›
- **ìŒì„± ë…¹ìŒ**: í‰ê·  30-60ë¶„ ë¶„ëŸ‰ì˜ ê³ í’ˆì§ˆ ìŒì„± ë°ì´í„° ìˆ˜ì§‘

---

## ğŸ›  í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

### Frontend Framework
```yaml
Language: JavaScript (ES6+)
Framework: React 19.1.0
Build Tool: Vite 6.3.5
Router: React Router DOM 7.6.0
```

**ì„ íƒ ì´ìœ **: 
- **React 19**: ìµœì‹  Concurrent Featuresë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„±ëŠ¥ í–¥ìƒ
- **Vite**: ë¹ ë¥¸ HMRê³¼ ê°œë°œ ê²½í—˜, í”„ë¡œë•ì…˜ ë¹Œë“œ ìµœì í™”
- **Context API**: ì „ì—­ ìƒíƒœ ê´€ë¦¬ (WebSocket, WebRTC Provider)

### Real-time Communication
```yaml
WebSocket: Native WebSocket API
WebRTC: P2P Mesh Topology
TURN/STUN: Twilio Network Traversal
Audio Processing: Web Audio API, MediaRecorder API
```

### HTTP Client & State Management
```yaml
HTTP: Axios 1.9.0 (Interceptor ê¸°ë°˜ ì¸ì¦)
State: React Context API + useReducer
Storage: localStorage + sessionStorage (ì¬ì—°ê²° ë³µêµ¬)
```

### UI/UX
```yaml
Styling: CSS Modules + Tailwind CSS 4.1.6
Assets: 595ê°œì˜ ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤ (ìºë¦­í„°, ë°°ê²½, ì•„ì´ì½˜)
Responsive: ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ëŒ€ì‘ (ìµœì†Œ 768px)
```

---

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           React Application             â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Pages (40+ í˜ì´ì§€)            â”‚ â”‚
â”‚  â”‚  - ê²Œì„ í”Œë¡œìš° (Game01~09)       â”‚ â”‚
â”‚  â”‚  - ë°© ìƒì„±/ì…ì¥ (Create, Join)   â”‚ â”‚
â”‚  â”‚  - ë§ˆì´í¬ í…ŒìŠ¤íŠ¸ (MicTest)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Context Providers              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  WebSocketProvider          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - ì—°ê²° ê´€ë¦¬                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - ë©”ì‹œì§€ ë¼ìš°íŒ…            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - ì¬ì—°ê²° ë¡œì§              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  WebRTCProvider             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - P2P ì—°ê²° ê´€ë¦¬            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - ì‹œê·¸ë„ë§                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - ìŒì„± ìŠ¤íŠ¸ë¦¼              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Utility Modules              â”‚   â”‚
â”‚  â”‚  - voiceManager (ìŒì„± ì²˜ë¦¬)    â”‚   â”‚
â”‚  â”‚  - axiosInstance (HTTP)         â”‚   â”‚
â”‚  â”‚  - storage (ë¡œì»¬ ì €ì¥ì†Œ)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend API (REST/WS)           â”‚
â”‚  - /ws/voice (ìŒì„± ìƒíƒœ)                â”‚
â”‚  - /ws/signaling (WebRTC)               â”‚
â”‚  - /rooms, /users (REST)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Structure

```
src/
â”œâ”€â”€ main.jsx                  # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”œâ”€â”€ App.jsx                   # ë¼ìš°íŒ… ì„¤ì •
â”‚
â”œâ”€â”€ core/
â”‚   â””â”€â”€ router.jsx           # ë¼ìš°í„° ì„¤ì •
â”‚
â”œâ”€â”€ pages/                    # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (40+)
â”‚   â”œâ”€â”€ Game01~09.jsx        # ê²Œì„ í”Œë¡œìš°
â”‚   â”œâ”€â”€ Create00~05.jsx      # ë°© ìƒì„± í”Œë¡œìš°
â”‚   â”œâ”€â”€ WaitingRoom.jsx      # ëŒ€ê¸°ì‹¤
â”‚   â”œâ”€â”€ MicTest.jsx          # ë§ˆì´í¬ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ components/               # ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ (60+)
â”‚   â”œâ”€â”€ Background.jsx       # ë°°ê²½ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ PrimaryButton.jsx    # ë²„íŠ¼
â”‚   â”œâ”€â”€ RoomCard.jsx         # ë°© ì¹´ë“œ
â”‚   â”œâ”€â”€ VoiceToggle.jsx      # ë§ˆì´í¬ í† ê¸€
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ WebSocketProvider.jsx    # WebSocket Context
â”œâ”€â”€ WebRTCProvider.jsx       # WebRTC Context
â”‚
â”œâ”€â”€ hooks/                    # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ useWebSocket.js      # WebSocket í›…
â”‚   â”œâ”€â”€ useWebRTC.js         # WebRTC í›…
â”‚   â”œâ”€â”€ useVoiceWebSocket.js # ìŒì„± ìƒíƒœ ë™ê¸°í™”
â”‚   â””â”€â”€ useTypingEffect.jsx  # íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ voiceManager.js      # ğŸ”¥ ìŒì„± ì²˜ë¦¬ í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ webrtcUtils.js       # WebRTC ìœ í‹¸
â”‚   â””â”€â”€ storage.js           # ë¡œì»¬ ì €ì¥ì†Œ
â”‚
â”œâ”€â”€ api/
â”‚   â””â”€â”€ axiosInstance.js     # HTTP í´ë¼ì´ì–¸íŠ¸ (ì¸í„°ì…‰í„°)
â”‚
â””â”€â”€ assets/                   # ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤ (595ê°œ)
    â”œâ”€â”€ characters/          # ìºë¦­í„° ì´ë¯¸ì§€
    â”œâ”€â”€ backgrounds/         # ë°°ê²½ ì´ë¯¸ì§€
    â””â”€â”€ icons/               # ì•„ì´ì½˜
```

**ì„¤ê³„ ì›ì¹™**:
- **Provider íŒ¨í„´**: Context APIë¡œ ì „ì—­ ìƒíƒœ ê´€ë¦¬ (WebSocket, WebRTC)
- **Custom Hooks**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UI ë¶„ë¦¬
- **ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©**: 60+ ê°œì˜ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸

---

## ğŸ’¡ ì£¼ìš” ê¸°ëŠ¥ ë° ê¸°ìˆ ì  ë„ì „

### 1. ì‹¤ì‹œê°„ 3ì ìŒì„± í†µì‹  (WebRTC)

#### ğŸ¯ ê³¼ì œ
- **P2P ì—°ê²° ì•ˆì •ì„±**: NAT/ë°©í™”ë²½ í™˜ê²½ì—ì„œ 3ëª…ì´ ë™ì‹œì— ì—°ê²°ë˜ì–´ì•¼ í•¨
- **Mesh Topology**: 3ëª… = 3ê°œì˜ PeerConnection (1-2, 1-3, 2-3)
- **ì‹œê·¸ë„ë§ ë™ê¸°í™”**: offer/answer/candidate ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥
- **ìŒì„± ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬**: ì†¡ì‹ /ë…¹ìŒ/ë¶„ì„ìš© ìŠ¤íŠ¸ë¦¼ì„ ë³„ë„ë¡œ ê´€ë¦¬
- **ë¸Œë¼ìš°ì € í˜¸í™˜ì„±**: Chrome, Safari, Firefoxì—ì„œ ê°ê° ë‹¤ë¥¸ ë¯¸ë””ì–´ í¬ë§· ì§€ì›

#### âœ… ì†”ë£¨ì…˜

**1) WebRTC ì‹œê·¸ë„ë§ (WebSocket ê¸°ë°˜)**

```javascript
// src/WebRTCProvider.jsx
const connectSignalingWebSocket = useCallback(() => {
  const ws = new WebSocket(`wss://dilemmai-idl.com/ws/signaling?room_code=${roomCode}&token=${token}`);
  
  ws.onopen = () => {
    // ìì‹ ì˜ user_idë¥¼ peer_idë¡œ ë“±ë¡
    ws.send(JSON.stringify({ 
      type: 'join', 
      peer_id: String(myUserId) 
    }));
  };
  
  ws.onmessage = async (event) => {
    const msg = JSON.parse(event.data);
    
    // ì„œë²„ê°€ ë³´ë‚¸ ë‹¤ë¥¸ ì°¸ê°€ì ëª©ë¡
    if (msg.type === 'peers') {
      for (const otherId of msg.peers) {
        if (otherId !== myUserId) {
          // ê° ì°¸ê°€ìì—ê²Œ offer ì „ì†¡
          await createOfferTo(String(otherId));
        }
      }
    }
    
    // offer ìˆ˜ì‹  â†’ answer ìƒì„±
    if (msg.type === 'offer') {
      const pc = getOrCreatePC(msg.from);
      await pc.setRemoteDescription({ type: 'offer', sdp: msg.sdp });
      
      // ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ ì¶”ê°€
      stream.getTracks().forEach(t => pc.addTrack(t, stream));
      
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      ws.send(JSON.stringify({
        type: 'answer',
        to: msg.from,
        from: myUserId,
        sdp: answer.sdp
      }));
    }
    
    // answer ìˆ˜ì‹ 
    if (msg.type === 'answer') {
      const pc = getOrCreatePC(msg.from);
      await pc.setRemoteDescription({ type: 'answer', sdp: msg.sdp });
    }
    
    // ICE candidate ìˆ˜ì‹ 
    if (msg.type === 'candidate') {
      const pc = getOrCreatePC(msg.from);
      await pc.addIceCandidate(new RTCIceCandidate(msg.candidate));
    }
  };
}, []);
```

**2) TURN Server Fallback (Twilio)**

```javascript
// src/WebRTCProvider.jsx - ICE ì„œë²„ ì„¤ì •
const fetchIceConfigFromServer = useCallback(async () => {
  // ë°±ì—”ë“œì—ì„œ Twilio TURN ìê²©ì¦ëª… ë°›ì•„ì˜¤ê¸°
  const res = await axiosInstance.get('/webrtc/ice-config', {
    params: { token: localStorage.getItem('access_token') }
  });
  
  const { iceServers, ttlSeconds, turnEnabled } = res.data;
  
  // STUN + TURN ì„¤ì •
  iceServersRef.current = iceServers;
  
  console.log('ğŸ§Š ICE config:', { turnEnabled, ttlSeconds });
  return iceServers;
}, []);

// PeerConnection ìƒì„± ì‹œ ì ìš©
const pc = new RTCPeerConnection({
  iceServers: iceServersRef.current || [
    { urls: 'stun:stun.l.google.com:19302' }
  ]
});
```

**3) ìŒì„± ìŠ¤íŠ¸ë¦¼ ìƒëª…ì£¼ê¸° ê´€ë¦¬**

```javascript
// src/utils/voiceManager.js
class VoiceManager {
  constructor() {
    this.baseMicStream = null;      // ì›ë³¸ ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ (1íšŒ ìƒì„±)
    this.recordingStream = null;     // ë…¹ìŒ ì „ìš© ìŠ¤íŠ¸ë¦¼ (clone)
    this.mediaStream = null;         // ë¶„ì„ ì „ìš© ìŠ¤íŠ¸ë¦¼ (WebAudio)
  }
  
  // âœ… í•µì‹¬: baseMicStreamì€ 1íšŒë§Œ ìƒì„±, ì´í›„ ì¬ì‚¬ìš©
  async ensureBaseMicStream() {
    if (this.hasLiveAudioTrack(this.baseMicStream)) {
      return this.baseMicStream;
    }
    
    const stream = await navigator.mediaDevices.getUserMedia({
      audio: {
        echoCancellation: true,
        noiseSuppression: true,
        autoGainControl: true,
        sampleRate: 44100
      }
    });
    
    this.baseMicStream = stream;
    return stream;
  }
  
  // âœ… ë…¹ìŒìš© ìŠ¤íŠ¸ë¦¼ì€ ë³„ë„ clone (ì¤‘ê°„ êµì²´ ê¸ˆì§€)
  ensureRecordingStreamFromBase(baseStream) {
    const track = baseStream.getAudioTracks()[0];
    // ìŠ¤íŠ¸ë¦¼ ê°ì²´ë§Œ ë¶„ë¦¬, íŠ¸ë™ì€ ê³µìœ 
    const recStream = new MediaStream([track]);
    this.recordingStream = recStream;
  }
  
  // âœ… track.stop()ì€ ë§ˆì§€ë§‰ ì •ë¦¬ ì‹œì—ë§Œ í˜¸ì¶œ
  releaseMic() {
    this.baseMicStream?.getTracks().forEach(t => t.stop());
    this.recordingStream?.getTracks().forEach(t => t.stop());
    this.baseMicStream = null;
    this.recordingStream = null;
  }
}
```

**ì„±ê³¼**:
- âœ… P2P ì—°ê²° ì„±ê³µë¥ : **80-90%** (STUNë§Œ)
- âœ… TURN ì ìš© í›„: **95%+** (NAT/ë°©í™”ë²½ í™˜ê²½ í¬í•¨)
- âœ… í‰ê·  ì—°ê²° ì‹œê°„: **2-3ì´ˆ**
- âœ… ìŒì„± í’ˆì§ˆ: **44.1kHz, ìŠ¤í…Œë ˆì˜¤** (ë¸Œë¼ìš°ì € ì§€ì› ì‹œ)

---

### 2. WebSocket ì—°ê²° ì•ˆì •ì„± ë° ì¬ì—°ê²°

#### ğŸ¯ ê³¼ì œ
- **ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •**: ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì¦ì€ ì—°ê²° ëŠê¹€
- **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨**: ì‚¬ìš©ìê°€ F5ë¥¼ ëˆ„ë¥´ë©´ ê²Œì„ì´ ëŠê¸°ëŠ” ë¬¸ì œ
- **ì—°ê²° ì¤‘ë³µ**: ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ëŸ¬ ë²ˆ ë§ˆìš´íŠ¸ë˜ë©´ì„œ ì—°ê²°ì´ ì¤‘ë³µ ìƒì„±
- **ë©”ì‹œì§€ ë¼ìš°íŒ…**: ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ë™ì‹œì— WebSocket ë©”ì‹œì§€ë¥¼ ë°›ì•„ì•¼ í•¨

#### âœ… ì†”ë£¨ì…˜

**1) ì¬ì—°ê²° ë¡œì§ (Exponential Backoff)**

```javascript
// src/WebSocketProvider.jsx
const scheduleReconnect = (currentSessionId) => {
  reconnectAttemptsRef.current += 1;
  const attemptCount = reconnectAttemptsRef.current;
  
  if (attemptCount > maxReconnectAttempts) {
    // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ â†’ ë©”ì¸ìœ¼ë¡œ ì´ë™
    finalizeDisconnection('ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •ìœ¼ë¡œ ì—°ê²°ì„ ë³µêµ¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  // Exponential Backoff: 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ â†’ ... (ìµœëŒ€ 30ì´ˆ)
  const delay = Math.min(reconnectDelay.current * 2, 30000);
  reconnectDelay.current = delay;
  
  reconnectTimer.current = setTimeout(() => {
    console.log(`ğŸ”„ WebSocket ì¬ì—°ê²° ì‹œë„ (${attemptCount}/${maxReconnectAttempts})`);
    connect(currentSessionId, true);
  }, delay);
};
```

**2) ìƒˆë¡œê³ ì¹¨ ë³µêµ¬ (Grace Period)**

```javascript
// src/WebSocketProvider.jsx
const RECONNECT_GRACE_MS = 20000; // 20ì´ˆ

// beforeunload ì´ë²¤íŠ¸ì—ì„œ í”Œë˜ê·¸ ì„¤ì •
useEffect(() => {
  const handleBeforeUnload = () => {
    sessionStorage.setItem('reloading', 'true');
    sessionStorage.setItem('reloading_expire_at', Date.now() + RECONNECT_GRACE_MS);
  };
  
  window.addEventListener('beforeunload', handleBeforeUnload);
  return () => window.removeEventListener('beforeunload', handleBeforeUnload);
}, []);

// ë§ˆìš´íŠ¸ ì‹œ ìë™ ì¬ì—°ê²°
useEffect(() => {
  const attemptAutoReconnect = async () => {
    if (!isReloadingGrace()) return;
    
    const startAt = Date.now();
    while (Date.now() - startAt < RECONNECT_GRACE_MS) {
      try {
        await initializeVoiceWebSocket(isHost);
        clearReloadingFlag();
        return; // ì„±ê³µ!
      } catch (err) {
        await new Promise(resolve => setTimeout(resolve, 2000));
      }
    }
    
    // 20ì´ˆ ë‚´ì— ë³µêµ¬ ì‹¤íŒ¨ â†’ ì¢…ë£Œ
    finalizeDisconnection('ì—°ê²° ì¬ì‹œë„ ì‹¤íŒ¨');
  };
  
  attemptAutoReconnect();
}, []);
```

**3) ì—°ê²° ì¤‘ë³µ ë°©ì§€**

```javascript
// src/WebSocketProvider.jsx
const initializeVoiceWebSocket = async (isHost = false) => {
  // ê°€ë“œ 1: ì´ë¯¸ ì´ˆê¸°í™” ì¤‘
  if (isInitializing.current) {
    console.log('â³ ì´ë¯¸ ì´ˆê¸°í™” ì¤‘... ëŒ€ê¸°');
    // ìµœëŒ€ 30ì´ˆ ëŒ€ê¸°
    let waitCount = 0;
    while (isInitializing.current && waitCount < 150) {
      await new Promise(resolve => setTimeout(resolve, 200));
      waitCount++;
    }
    return;
  }
  
  // ê°€ë“œ 2: ì´ë¯¸ ì´ˆê¸°í™”ë¨
  if (isConnected && sessionId) {
    console.log('âœ… ì´ë¯¸ ì´ˆê¸°í™”ë¨');
    return;
  }
  
  isInitializing.current = true;
  
  try {
    // ì´ˆê¸°í™” ë¡œì§
    // ...
  } finally {
    isInitializing.current = false;
  }
};
```

**4) ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë¼ìš°íŒ…**

```javascript
// src/WebSocketProvider.jsx
const messageHandlers = useRef(new Map());

const addMessageHandler = (handlerId, handler) => {
  messageHandlers.current.set(handlerId, handler);
};

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  
  // ëª¨ë“  í•¸ë“¤ëŸ¬ì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
  messageHandlers.current.forEach((handler, handlerId) => {
    try {
      handler(msg);
    } catch (error) {
      console.error(`âŒ í•¸ë“¤ëŸ¬ ì—ëŸ¬ (${handlerId}):`, error);
    }
  });
};

// ì‚¬ìš© ì˜ˆì‹œ (í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸)
useEffect(() => {
  const handleMessage = (msg) => {
    if (msg.type === 'next_page') {
      navigate('/game02');
    }
  };
  
  addMessageHandler('game01', handleMessage);
  return () => removeMessageHandler('game01');
}, []);
```

**ì„±ê³¼**:
- âœ… ì¬ì—°ê²° ì„±ê³µë¥ : **98%+** (20ì´ˆ grace ë‚´)
- âœ… ì—°ê²° ì¤‘ë³µ: **ì™„ì „ ë°©ì§€** (ì¤‘ë³µ ê°€ë“œ)
- âœ… ë©”ì‹œì§€ ì†ì‹¤: **0ê±´** (í•¸ë“¤ëŸ¬ ë¼ìš°íŒ…)

---

### 3. ìŒì„± ë…¹ìŒ ë° ë°ì´í„° ìˆ˜ì§‘

#### ğŸ¯ ê³¼ì œ
- **ë…¹ìŒ ëˆ„ë½**: ì´ˆê¸°í™” ì‹¤íŒ¨ë¡œ "ë§ˆì§€ë§‰ 1-2ì´ˆë§Œ ë…¹ìŒ"ë˜ëŠ” í˜„ìƒ
- **ìŠ¤íŠ¸ë¦¼ êµì²´**: ì¤‘ê°„ì— ìŠ¤íŠ¸ë¦¼ì„ êµì²´í•˜ë©´ ë…¹ìŒì´ ëŠê¹€
- **ë¸Œë¼ìš°ì €ë³„ í¬ë§·**: Chrome(webm), Safari(mp4)ë§ˆë‹¤ ë‹¤ë¥¸ í¬ë§· ì§€ì›
- **ìë™ ë‹¤ìš´ë¡œë“œ**: ë¸Œë¼ìš°ì € ë³´ì•ˆìœ¼ë¡œ ìë™ ë‹¤ìš´ë¡œë“œê°€ ë§‰í˜

#### âœ… ì†”ë£¨ì…˜

**1) ì¡°ê¸° ë…¹ìŒ ì‹œì‘ (ë¡œì»¬ ìš°ì„ )**

```javascript
// src/WebRTCProvider.jsx
useEffect(() => {
  let cancelled = false;
  const tick = async () => {
    if (cancelled || voiceManager?.exitInProgress) return;
    
    // âœ… í•µì‹¬: WebRTC ì´ˆê¸°í™” ì „ì— ë¡œì»¬ ë…¹ìŒë¶€í„° ì‹œì‘
    await voiceManager.startLocalMicRecordingIfNeeded?.();
    
    // WebRTC ì´ˆê¸°í™”ëŠ” ì„ í–‰ ì¡°ê±´ì´ ì¤€ë¹„ëœ í›„
    if (!isInitialized && token && roomCode) {
      await initializeWebRTC();
    }
  };
  
  tick();
  const timer = setInterval(tick, 1500); // 1.5ì´ˆë§ˆë‹¤ ì¬ì‹œë„
  
  return () => {
    cancelled = true;
    clearInterval(timer);
  };
}, [isInitialized, initializeWebRTC]);
```

**2) ìŠ¤íŠ¸ë¦¼ ë¶ˆë³€ì„± (ì¤‘ê°„ êµì²´ ê¸ˆì§€)**

```javascript
// src/utils/voiceManager.js
setRecordingStream(stream) {
  // âœ… ë…¹ìŒ ì¤‘ì—ëŠ” recordingStreamì„ ì ˆëŒ€ êµì²´í•˜ì§€ ì•ŠìŒ
  if (this.isRecording && this.recordingStream && this.recordingStream !== stream) {
    console.warn('âš ï¸ ë…¹ìŒ ì¤‘ì—ëŠ” ìŠ¤íŠ¸ë¦¼ êµì²´ ê¸ˆì§€ â†’ ìš”ì²­ ë¬´ì‹œ');
    return false;
  }
  
  this.recordingStream = stream;
  return true;
}
```

**3) ë¸Œë¼ìš°ì €ë³„ í¬ë§· ìë™ ì„ íƒ**

```javascript
// src/utils/voiceManager.js
startRecording() {
  const preferredTypes = [
    'audio/webm;codecs=opus',  // Chrome
    'audio/webm',
    'audio/ogg;codecs=opus',
    'audio/ogg',
    'audio/mp4',               // Safari
  ];
  
  const pickMimeType = () => {
    for (const type of preferredTypes) {
      if (MediaRecorder.isTypeSupported(type)) {
        return type;
      }
    }
    return null;
  };
  
  const chosen = pickMimeType();
  this.mediaRecorder = chosen
    ? new MediaRecorder(stream, { mimeType: chosen })
    : new MediaRecorder(stream);
  
  // timesliceë¥¼ 250msë¡œ ì¤„ì—¬ì„œ ì²­í¬ ëˆ„ì ì„ ì•ˆì •í™”
  this.mediaRecorder.start(250);
}
```

**4) ë¡œì»¬ ì €ì¥ (ë””ë²„ê¹…ìš©)**

```javascript
// src/utils/voiceManager.js
saveRecordingToLocal(recordingData) {
  const blob = recordingData?.blob;
  if (!blob || !blob.size) return false;
  
  const filename = this.buildRecordingFilename({ reason: 'game_end' }, blob);
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename; // recording_session_id_game_end_timestamp.webm
  a.click();
  
  console.log('ğŸ’¾ ë¡œì»¬ ì €ì¥ ì™„ë£Œ:', {
    filename,
    size: this.formatBytes(blob.size),
    duration: recordingData.duration
  });
}
```

**ì„±ê³¼**:
- âœ… ë…¹ìŒ ëˆ„ë½: **0ê±´** (ì¡°ê¸° ì‹œì‘ ë¡œì§)
- âœ… í‰ê·  ë…¹ìŒ ê¸¸ì´: **5-10ë¶„** (ê²Œì„ ì „ì²´)
- âœ… ë°ì´í„° í’ˆì§ˆ: **44.1kHz, 256kbps** (webm/opus)
- âœ… ìˆ˜ì§‘ ë°ì´í„°: **1,693ëª…** ì°¸ê°€ì ìŒì„± ë°ì´í„°

---

### 4. ë¸Œë¼ìš°ì € ìë™ì¬ìƒ ì •ì±… ëŒ€ì‘

#### ğŸ¯ ê³¼ì œ
- **ìë™ì¬ìƒ ì°¨ë‹¨**: íŠ¹íˆ ëª¨ë°”ì¼ Safariì—ì„œ audio.play()ê°€ ë§‰í˜
- **AudioContext ì¼ì‹œì¤‘ì§€**: ì‚¬ìš©ì ì œìŠ¤ì²˜ ì—†ì´ëŠ” suspended ìƒíƒœ
- **ì›ê²© ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨**: ìƒëŒ€ë°© ëª©ì†Œë¦¬ê°€ ì•ˆ ë“¤ë¦¼

#### âœ… ì†”ë£¨ì…˜

**1) ì‚¬ìš©ì ì œìŠ¤ì²˜ íŠ¸ë¦¬ê±°**

```javascript
// src/WebRTCProvider.jsx
const requestAudioUnlock = useCallback(() => {
  const tryPlayAll = () => {
    // AudioContext resume (ëª¨ë°”ì¼ ì‚¬íŒŒë¦¬ ëŒ€ì‘)
    if (voiceManager?.audioContext?.state === 'suspended') {
      voiceManager.audioContext.resume();
      console.log('ğŸ”Š AudioContext resumed');
    }
    
    // ëª¨ë“  ì›ê²© ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œë„
    const audios = document.querySelectorAll('audio[data-user-id]');
    audios.forEach((audio) => {
      audio.play().catch(() => {});
    });
  };
  
  window.addEventListener('click', tryPlayAll, { once: true });
  window.addEventListener('touchstart', tryPlayAll, { once: true });
}, []);

// ontrackì—ì„œ ìë™ì¬ìƒ ì‹œë„ â†’ ì‹¤íŒ¨ ì‹œ unlock ìš”ì²­
pc.ontrack = (e) => {
  const audio = document.createElement('audio');
  audio.autoplay = true;
  audio.srcObject = e.streams[0];
  
  audio.play().catch((err) => {
    console.warn('ğŸ”‡ ìë™ì¬ìƒ ì°¨ë‹¨ë¨, ì‚¬ìš©ì ì œìŠ¤ì²˜ í•„ìš”');
    requestAudioUnlock();
  });
};
```

**2) ìŒì„± ë¶„ì„ ì´ˆê¸°í™” ì‹œ AudioContext í™•ì¸**

```javascript
// src/utils/voiceManager.js
async setupAudioAnalysisWithWebRTCStream(stream) {
  this.audioContext = new AudioContext();
  this.analyser = this.audioContext.createAnalyser();
  this.micNode = this.audioContext.createMediaStreamSource(stream);
  this.micNode.connect(this.analyser);
  
  // AudioContextê°€ suspended ìƒíƒœë©´ resume ì‹œë„
  if (this.audioContext.state === 'suspended') {
    console.warn('âš ï¸ AudioContext suspended â†’ resume ì‹œë„');
    await this.audioContext.resume();
  }
}
```

**ì„±ê³¼**:
- âœ… ìë™ì¬ìƒ ì„±ê³µë¥ : **99%+** (ì²« í´ë¦­ í›„)
- âœ… ëª¨ë°”ì¼ ì§€ì›: **iOS Safari í¬í•¨** ì „ì²´ ë¸Œë¼ìš°ì €

---

## ğŸ”„ ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„

### WebSocket ë©”ì‹œì§€ í”„ë¡œí† ì½œ

#### ìŒì„± ìƒíƒœ ë™ê¸°í™”

```javascript
// ë§ˆì´í¬ ON/OFF + ë°œí™” ìƒíƒœ ì „ì†¡
const message = {
  type: "voice_status_update",
  data: {
    user_id: participantId,
    is_mic_on: true,
    is_speaking: true,
    session_id: sessionId
  }
};

// ë‹¤ë¥¸ ì°¸ê°€ìì˜ ìƒíƒœ ìˆ˜ì‹ 
{
  type: "voice_status",
  user_id: 123,
  is_mic_on: true,
  is_speaking: false
}
```

#### í˜ì´ì§€ ë™ê¸°í™”

```javascript
// ë°©ì¥ì´ í˜ì´ì§€ ì „í™˜ íŠ¸ë¦¬ê±°
{
  type: "next_page",
  page: "/game02"
}

// ëª¨ë“  ì°¸ê°€ìê°€ ë™ì‹œì— navigate
useEffect(() => {
  const handleMessage = (msg) => {
    if (msg.type === 'next_page') {
      navigate(msg.page);
    }
  };
  
  addMessageHandler('pageSync', handleMessage);
  return () => removeMessageHandler('pageSync');
}, [navigate]);
```

#### ì„ íƒ/í•©ì˜ ë™ê¸°í™”

```javascript
// ê°œì¸ ì„ íƒ ì™„ë£Œ ìƒíƒœ
{
  type: "choice_submitted",
  user_id: 123,
  round: 2,
  choice: 1
}

// ì „ì²´ ì°¸ê°€ì ì„ íƒ í˜„í™© ì¡°íšŒ
GET /rooms/{room_code}/choice-status
{
  "round_2_choices": [
    { "user_id": 123, "choice": 1, "submitted": true },
    { "user_id": 456, "choice": 2, "submitted": true },
    { "user_id": 789, "choice": null, "submitted": false }
  ],
  "all_submitted": false
}
```

---

## ğŸ¤ WebRTC ìŒì„± í†µì‹ 

### P2P ì—°ê²° íë¦„

```
User A (ë°©ì¥)          Server (ì‹œê·¸ë„ë§)          User B, C
   â”‚                        â”‚                        â”‚
   â”œâ”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚<â”€ peers: [B, C] â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
   â”‚                        â”‚<â”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ B
   â”œâ”€ offer â†’ B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
   â”‚                        â”œâ”€ offer â†’ B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚<â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ B
   â”‚<â”€ answer â† B â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
   â”‚                        â”‚                        â”‚
   â”œâ”€ offer â†’ C â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚<â”€ join â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ C
   â”‚                        â”œâ”€ offer â†’ C â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚<â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ C
   â”‚<â”€ answer â† C â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
   â”‚                        â”‚                        â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€ P2P RTC Connection (Mesh) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
```

### PeerConnection ê´€ë¦¬

```javascript
// src/WebRTCProvider.jsx
const pcsRef = useRef(new Map()); // peerId -> RTCPeerConnection

function getOrCreatePC(remotePeerId) {
  const key = String(remotePeerId);
  
  // ìê¸° ìì‹ ê³¼ëŠ” ì—°ê²° ì•ˆ í•¨
  if (key === SELF()) return null;
  
  // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì¬ì‚¬ìš©
  if (pcsRef.current.has(key)) {
    return pcsRef.current.get(key);
  }
  
  // ìƒˆ PeerConnection ìƒì„±
  const pc = new RTCPeerConnection({
    iceServers: iceServersRef.current
  });
  
  // ontrack: ì›ê²© ì˜¤ë””ì˜¤ ìˆ˜ì‹ 
  pc.ontrack = (e) => {
    const audio = document.createElement('audio');
    audio.autoplay = true;
    audio.srcObject = e.streams[0];
    audio.setAttribute('data-user-id', key);
    document.body.appendChild(audio);
    audio.play().catch(requestAudioUnlock);
  };
  
  // onicecandidate: ICE candidate ì „ì†¡
  pc.onicecandidate = (e) => {
    if (!e.candidate) return;
    signalingWs.send(JSON.stringify({
      type: 'candidate',
      from: SELF(),
      to: key,
      candidate: e.candidate
    }));
  };
  
  // onconnectionstatechange: ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
  pc.onconnectionstatechange = () => {
    console.log(`PC(${key}): ${pc.connectionState}`);
  };
  
  pcsRef.current.set(key, pc);
  return pc;
}
```

### Offer/Answer êµí™˜

```javascript
async function createOfferTo(remotePeerId) {
  const pc = getOrCreatePC(remotePeerId);
  if (!pc) return;
  
  // ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ ì¶”ê°€
  const stream = masterStreamRef.current;
  if (!stream) {
    console.warn('âš ï¸ ë¡œì»¬ ìŠ¤íŠ¸ë¦¼ì´ ì—†ì–´ offer ìƒì„± ìŠ¤í‚µ');
    return;
  }
  
  stream.getTracks().forEach(track => pc.addTrack(track, stream));
  
  // SDP offer ìƒì„±
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  
  // ì‹œê·¸ë„ë§ ì„œë²„ë¡œ ì „ì†¡
  signalingWs.send(JSON.stringify({
    type: 'offer',
    from: SELF(),
    to: remotePeerId,
    sdp: offer.sdp
  }));
}
```

---

## ğŸ“Š ìƒíƒœ ê´€ë¦¬ ë° ë™ê¸°í™”

### Context API êµ¬ì¡°

```javascript
// src/WebSocketProvider.jsx
export const WebSocketProvider = ({ children }) => {
  const [isConnected, setIsConnected] = useState(false);
  const [sessionId, setSessionId] = useState(null);
  const messageHandlers = useRef(new Map());
  
  const value = {
    isConnected,
    sessionId,
    sendMessage,
    addMessageHandler,
    removeMessageHandler,
    initializeVoiceWebSocket
  };
  
  return (
    <WebSocketContext.Provider value={value}>
      {children}
    </WebSocketContext.Provider>
  );
};

// ì‚¬ìš©
const { sendMessage, addMessageHandler } = useWebSocket();
```

### localStorage í™œìš© (ì„¸ì…˜ ë³µêµ¬)

```javascript
// ê²Œì„ ì§„í–‰ ìƒíƒœ ì €ì¥
localStorage.setItem('room_code', 'ABC123');
localStorage.setItem('session_id', 'voice-session-uuid');
localStorage.setItem('myrole_id', '1');
localStorage.setItem('nickname', 'ì°¸ê°€ì1');

// ìƒˆë¡œê³ ì¹¨ í›„ ë³µêµ¬
const roomCode = localStorage.getItem('room_code');
if (roomCode && isReloadingGrace()) {
  await reconnectToRoom(roomCode);
}
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. ì´ë¯¸ì§€ ìµœì í™”

```javascript
// 595ê°œì˜ ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤ â†’ Lazy Loading
import { lazy, Suspense } from 'react';

const CharacterImage = lazy(() => import('./assets/characters/character1.jpg'));

<Suspense fallback={<div>ë¡œë”© ì¤‘...</div>}>
  <CharacterImage />
</Suspense>
```

### 2. ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜

```javascript
import { memo, useMemo } from 'react';

const RoomCard = memo(({ room }) => {
  const participantCount = useMemo(() => {
    return room.participants?.length || 0;
  }, [room.participants]);
  
  return <div>...</div>;
});
```

### 3. WebSocket ë©”ì‹œì§€ í•„í„°ë§

```javascript
// ë¶ˆí•„ìš”í•œ ë©”ì‹œì§€ëŠ” ì¡°ê¸° ë¦¬í„´
ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  
  // ë‚˜ì—ê²Œ ì˜¨ ë©”ì‹œì§€ê°€ ì•„ë‹ˆë©´ ë¬´ì‹œ
  if (msg.to && msg.to !== myUserId) return;
  
  // í•¸ë“¤ëŸ¬ ì‹¤í–‰
  messageHandlers.current.forEach(handler => handler(msg));
};
```

**ì„±ê³¼**:
- âœ… ì´ˆê¸° ë¡œë”© ì‹œê°„: **1.5ì´ˆ ì´í•˜**
- âœ… í˜ì´ì§€ ì „í™˜: **200ms ì´í•˜**
- âœ… ë©”ëª¨ë¦¬ ì‚¬ìš©: **100MB ì´í•˜** (3ì ì—°ê²° ì‹œ)

---

## ğŸŒ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

### ì§€ì› ë¸Œë¼ìš°ì €

| ë¸Œë¼ìš°ì € | ë²„ì „ | WebRTC | MediaRecorder | ë¹„ê³  |
|---------|------|--------|---------------|------|
| Chrome | 90+ | âœ… | âœ… (webm) | ìµœì  |
| Safari | 14+ | âœ… | âš ï¸ (mp4) | ìë™ì¬ìƒ ì£¼ì˜ |
| Firefox | 88+ | âœ… | âœ… (webm) | - |
| Edge | 90+ | âœ… | âœ… (webm) | Chrome ê¸°ë°˜ |

### ë¸Œë¼ìš°ì €ë³„ ëŒ€ì‘

```javascript
// Safari: getUserMedia ê¶Œí•œ ìš”ì²­ ì‹œ HTTPS í•„ìˆ˜
if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {
  console.log('Safari ê°ì§€: HTTPS í™•ì¸ í•„ìš”');
}

// iOS: AudioContext resume í•„ìˆ˜
if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
  await audioContext.resume();
}

// Firefox: MediaRecorder mimeType í™•ì¸
if (MediaRecorder.isTypeSupported('audio/ogg;codecs=opus')) {
  mimeType = 'audio/ogg;codecs=opus';
}
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. "ë§ˆì§€ë§‰ 1-2ì´ˆë§Œ ë…¹ìŒë˜ëŠ” í˜„ìƒ"

**ì¦ìƒ**: ë…¹ìŒ ë°ì´í„°ê°€ ê·¹íˆ ì§§ìŒ (5-10ë¶„ ì˜ˆìƒ â†’ 1-2ì´ˆ ì‹¤ì œ)

**ì›ì¸**:
- ì´ˆê¸°í™” ì‹¤íŒ¨ë¡œ ë…¹ìŒ ì‹œì‘ì´ ê²Œì„ ëë¶€ë¶„ì—ë§Œ ë¨
- WebRTC/WebSocket ì´ˆê¸°í™”ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë…¹ìŒì´ ì‹œì‘ ì•ˆ ë¨

**í•´ê²°**:
```javascript
// âœ… ì„ í–‰ ì¡°ê±´ ì—†ì´ ë¡œì»¬ ë…¹ìŒë¶€í„° ì‹œì‘
useEffect(() => {
  const tick = async () => {
    // WebRTC ì´ˆê¸°í™” ì „ì— ë¡œì»¬ ë…¹ìŒë¶€í„° ì¼œê¸°
    await voiceManager.startLocalMicRecordingIfNeeded?.();
    
    // WebRTCëŠ” ë‚˜ì¤‘ì— ì´ˆê¸°í™”
    if (!isInitialized && token && roomCode) {
      await initializeWebRTC();
    }
  };
  
  tick();
  const timer = setInterval(tick, 1500);
  return () => clearInterval(timer);
}, []);
```

---

### 2. "WebSocket ì—°ê²°ì´ ì¤‘ë³µ ìƒì„±ë˜ëŠ” ë¬¸ì œ"

**ì¦ìƒ**: ê°™ì€ ì„¸ì…˜ì— ì—¬ëŸ¬ WebSocket ì—°ê²°ì´ ìƒì„±ë¨

**ì›ì¸**:
- React Strict Mode (ê°œë°œ í™˜ê²½)
- ì»´í¬ë„ŒíŠ¸ ì¬ë§ˆìš´íŠ¸
- ì¤‘ë³µ ê°€ë“œ ë¶€ì¬

**í•´ê²°**:
```javascript
const initializeVoiceWebSocket = async (isHost) => {
  // ê°€ë“œ 1: ì´ë¯¸ ì´ˆê¸°í™” ì¤‘
  if (isInitializing.current) {
    await waitForInitialization();
    return;
  }
  
  // ê°€ë“œ 2: ì´ë¯¸ ì´ˆê¸°í™”ë¨
  if (isConnected && sessionId) {
    return;
  }
  
  isInitializing.current = true;
  try {
    // ì´ˆê¸°í™” ë¡œì§
  } finally {
    isInitializing.current = false;
  }
};
```

---

### 3. "ë…¹ìŒ ì¤‘ ìŠ¤íŠ¸ë¦¼ êµì²´ë¡œ 1ì´ˆë§Œ ë…¹ìŒë˜ëŠ” ë¬¸ì œ"

**ì¦ìƒ**: MediaRecorderê°€ ì¤‘ê°„ì— ëŠê²¨ì„œ 1ì´ˆì§œë¦¬ íŒŒì¼ë§Œ ìƒì„±ë¨

**ì›ì¸**:
- ë…¹ìŒ ì¤‘ì— `recordingStream`ì„ êµì²´í•˜ë©´ ê¸°ì¡´ MediaRecorderê°€ ë¬´íš¨í™”ë¨
- íŠ¸ë™ì„ stop()í•˜ë©´ ë…¹ìŒì´ ì¦‰ì‹œ ì¢…ë£Œë¨

**í•´ê²°**:
```javascript
setRecordingStream(stream) {
  // âœ… ë…¹ìŒ ì¤‘ì—ëŠ” ìŠ¤íŠ¸ë¦¼ êµì²´ ê¸ˆì§€
  if (this.isRecording && this.recordingStream && this.recordingStream !== stream) {
    console.warn('âš ï¸ ë…¹ìŒ ì¤‘ì—ëŠ” ìŠ¤íŠ¸ë¦¼ êµì²´ ê¸ˆì§€');
    return false;
  }
  
  this.recordingStream = stream;
  return true;
}
```

---

### 4. "Safariì—ì„œ ì›ê²© ì˜¤ë””ì˜¤ê°€ ì•ˆ ë“¤ë¦¬ëŠ” ë¬¸ì œ"

**ì¦ìƒ**: ìì‹ ì˜ ë§ˆì´í¬ëŠ” ë˜ëŠ”ë° ìƒëŒ€ë°© ëª©ì†Œë¦¬ê°€ ì•ˆ ë“¤ë¦¼

**ì›ì¸**:
- Safari ìë™ì¬ìƒ ì •ì±…ìœ¼ë¡œ audio.play()ê°€ ì°¨ë‹¨ë¨
- AudioContextê°€ suspended ìƒíƒœ

**í•´ê²°**:
```javascript
// 1) ì‚¬ìš©ì ì œìŠ¤ì²˜ì—ì„œ AudioContext resume
if (audioContext.state === 'suspended') {
  await audioContext.resume();
}

// 2) ì²« í´ë¦­/í„°ì¹˜ ì‹œ ëª¨ë“  audio ì¬ìƒ ì‹œë„
const tryPlayAll = () => {
  document.querySelectorAll('audio[data-user-id]').forEach(a => a.play());
};
window.addEventListener('click', tryPlayAll, { once: true });
```

---

### 5. "ìƒˆë¡œê³ ì¹¨ ì‹œ ê²Œì„ì´ ëŠê¸°ëŠ” ë¬¸ì œ"

**ì¦ìƒ**: ì‚¬ìš©ìê°€ F5ë¥¼ ëˆ„ë¥´ë©´ ê²Œì„ì—ì„œ í‡´ì¥ë¨ 

**ì›ì¸**:
- WebSocket/WebRTCê°€ ì¬ì—°ê²°ë˜ì§€ ì•ŠìŒ 
- ë°±ì—”ë“œê°€ ì—°ê²° ëŠê¹€ì„ í‡´ì¥ìœ¼ë¡œ ê°„ì£¼ 

**í•´ê²°**:
```javascript
// 1) beforeunloadì—ì„œ "ìƒˆë¡œê³ ì¹¨ ì¤‘" í”Œë˜ê·¸ ì„¤ì •
window.addEventListener('beforeunload', () => {
  sessionStorage.setItem('reloading', 'true');
  sessionStorage.setItem('reloading_expire_at', Date.now() + 20000);
});

// 2) ë§ˆìš´íŠ¸ ì‹œ í”Œë˜ê·¸ í™•ì¸ â†’ 20ì´ˆ ë‚´ ì¬ì—°ê²° ì‹œë„
if (sessionStorage.getItem('reloading') === 'true') {
  const expireAt = parseInt(sessionStorage.getItem('reloading_expire_at'));
  if (Date.now() < expireAt) {
    await autoReconnect();
  }
}
```

---

## ğŸ”® í–¥í›„ ê°œì„ ì‚¬í•­

### 1. ì„±ëŠ¥ ê°œì„ 
- [ ] WebRTC SFU (Selective Forwarding Unit) ë„ì… (4ì¸ ì´ìƒ í™•ì¥ ì‹œ)
- [ ] Virtual List (react-window) ì ìš© (ë°© ëª©ë¡ 1000ê°œ ì´ìƒ ì‹œ)
- [ ] Service Worker (ì˜¤í”„ë¼ì¸ ì§€ì›, í‘¸ì‹œ ì•Œë¦¼)
- [ ] Progressive Web App (PWA) ë³€í™˜

### 2. ê¸°ëŠ¥ í™•ì¥
- [ ] í™”ë©´ ê³µìœ  (WebRTC getDisplayMedia)
- [ ] ì‹¤ì‹œê°„ ìë§‰ (Web Speech API)
- [ ] ì±„íŒ… ê¸°ëŠ¥ (WebSocket ê¸°ë°˜)
- [ ] ë¦¬í”Œë ˆì´ ê¸°ëŠ¥ (ë…¹ìŒ ì¬ìƒ)

### 3. UX ê°œì„ 
- [ ] ë‹¤í¬ ëª¨ë“œ ì§€ì›
- [ ] ì• ë‹ˆë©”ì´ì…˜ ê°•í™” (Framer Motion)
- [ ] í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (ë°©í–¥í‚¤ë¡œ ì„ íƒ ë“±)
- [ ] ì ‘ê·¼ì„± (ARIA ë¼ë²¨, ìŠ¤í¬ë¦° ë¦¬ë”)

### 4. ê°œë°œ ìƒì‚°ì„±
- [ ] TypeScript ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] Storybook (ì»´í¬ë„ŒíŠ¸ ë¬¸ì„œí™”)
- [ ] Cypress (E2E í…ŒìŠ¤íŠ¸)
- [ ] Jest + RTL (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

### ë‚´ë¶€ ë¬¸ì„œ
- [WebSocket ì¬ì—°ê²° ê°€ì´ë“œ](./docs/websocket-reconnection.md)
- [WebRTC ì—°ê²° ë””ë²„ê¹…](./docs/webrtc-debugging.md)
- [ìŒì„± ë…¹ìŒ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](./docs/voice-recording-troubleshooting.md)

### ì™¸ë¶€ ë¬¸ì„œ
- [MDN Web APIs](https://developer.mozilla.org/en-US/docs/Web/API)
- [WebRTC ê³µì‹ ë¬¸ì„œ](https://webrtc.org/getting-started/overview)
- [React ê³µì‹ ë¬¸ì„œ](https://react.dev/)
- [Vite ê³µì‹ ë¬¸ì„œ](https://vitejs.dev/)

---

## ğŸ“ ë°°ìš´ ì  ë° íšŒê³ 

### ê¸°ìˆ ì  ì„±ì¥

**1. WebRTCì˜ ë³µì¡ì„±ê³¼ ì•ˆì •ì„±**
- P2P ì—°ê²°ì€ ê²‰ë³´ê¸°ì—” ê°„ë‹¨í•˜ì§€ë§Œ, NAT/ë°©í™”ë²½ í™˜ê²½ì—ì„œëŠ” TURN ì„œë²„ê°€ í•„ìˆ˜
- ì‹œê·¸ë„ë§ ì„œë²„ì˜ ë©”ì‹œì§€ ìˆœì„œê°€ í‹€ì–´ì§€ë©´ ì—°ê²°ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
- Mesh TopologyëŠ” 3-4ëª…ê¹Œì§€ëŠ” ê´œì°®ì§€ë§Œ, ê·¸ ì´ìƒì€ SFU ê³ ë ¤ í•„ìš”

**2. ì‹¤ì‹œê°„ í†µì‹ ì˜ ì–´ë ¤ì›€**
- WebSocket ì¬ì—°ê²° ë¡œì§ì€ ë‹¨ìˆœíˆ "ë‹¤ì‹œ ì—°ê²°"ì´ ì•„ë‹ˆë¼, ìƒíƒœ ë³µêµ¬, ë©”ì‹œì§€ ì¤‘ë³µ ë°©ì§€, ê·¸ë ˆì´ìŠ¤ ê¸°ê°„ ë“± ë§ì€ ê²ƒì„ ê³ ë ¤í•´ì•¼ í•¨
- ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…(ìë™ì¬ìƒ, HTTPS í•„ìˆ˜)ì€ ê°œë°œ ì‹œì—ëŠ” ëª°ëë˜ ë¶€ë¶„ì´ í”„ë¡œë•ì…˜ì—ì„œ ë§ì´ ë°œê²¬ë¨

**3. ìŒì„± ì²˜ë¦¬ì˜ ì„¸ë°€í•¨**
- MediaStream/MediaRecorderëŠ” "ê·¸ëƒ¥ ë…¹ìŒ"ì´ ì•„ë‹ˆë¼, ìŠ¤íŠ¸ë¦¼ì˜ ìƒëª…ì£¼ê¸°, íŠ¸ë™ì˜ ìƒíƒœ, ë¸Œë¼ìš°ì €ë³„ í¬ë§·ê¹Œì§€ ê³ ë ¤í•´ì•¼ í•¨
- "ë§ˆì§€ë§‰ 1ì´ˆë§Œ ë…¹ìŒë˜ëŠ” ë²„ê·¸"ëŠ” ì´ˆê¸°í™” íƒ€ì´ë° ë¬¸ì œì˜€ê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„ í–‰ ì¡°ê±´ ì—†ëŠ” ì¡°ê¸° ë…¹ìŒ ì‹œì‘ì´ í•µì‹¬ì´ì—ˆìŒ

### í”„ë¡œì íŠ¸ ê´€ë¦¬

**ì˜í•œ ì **:
- âœ… ì²´ê³„ì ì¸ ë¡œê¹…ìœ¼ë¡œ í”„ë¡œë•ì…˜ ë²„ê·¸ë¥¼ ë¹ ë¥´ê²Œ ì¶”ì 
- âœ… Context APIë¡œ ì „ì—­ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬
- âœ… ë””ë²„ê¹…ìš© ì „ì—­ í•¨ìˆ˜ (`window.debugWebRTC`)ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸

**ì•„ì‰¬ìš´ ì **:
- âš ï¸ TypeScriptë¥¼ ì²˜ìŒë¶€í„° ë„ì…í–ˆìœ¼ë©´ íƒ€ì… ì•ˆì •ì„±ì´ ë” ì¢‹ì•˜ì„ ê²ƒ
- âš ï¸ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë¶€ì¡±í•´ì„œ ë¦¬íŒ©í† ë§ ì‹œ ë¶ˆì•ˆí•¨
- âš ï¸ ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©ì„±ì„ ë” ê³ ë ¤í–ˆìœ¼ë©´ ì¤‘ë³µ ì½”ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆì„ ê²ƒ

---

## ğŸ¤ ê¸°ì—¬

**Frontend Developer**
- ì „ì²´ UI/UX ì„¤ê³„ ë° êµ¬í˜„
- WebSocket/WebRTC ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„
- ìŒì„± ë…¹ìŒ ë° ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬
- ì¬ì—°ê²° ë¡œì§ ë° ì•ˆì •ì„± ê°œì„ 
- ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ëŒ€ì‘
- í”„ë¡œë•ì…˜ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

This project is private and proprietary.

---

## ğŸ“ Contact

**í”„ë¡œì íŠ¸ URL**: https://dilemmai-idl.com/  
**GitHub**: (Private Repository)

---

<div align="center">

**Built with â¤ï¸ using React + WebRTC**

![React](https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=react&logoColor=black)
![Vite](https://img.shields.io/badge/Vite-646CFF?style=for-the-badge&logo=vite&logoColor=white)
![WebRTC](https://img.shields.io/badge/WebRTC-333333?style=for-the-badge&logo=webrtc&logoColor=white)
![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black)

</div>
